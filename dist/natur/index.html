<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>natur cook book | EMPTY916</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="empty site">
    
    <link rel="preload" href="/assets/css/0.styles.fdde5c9a.css" as="style"><link rel="preload" href="/assets/js/app.57dfc609.js" as="script"><link rel="preload" href="/assets/js/2.e4845fa5.js" as="script"><link rel="preload" href="/assets/js/6.11836c2b.js" as="script"><link rel="prefetch" href="/assets/js/10.fee5e175.js"><link rel="prefetch" href="/assets/js/11.5707b049.js"><link rel="prefetch" href="/assets/js/12.2724b7f8.js"><link rel="prefetch" href="/assets/js/13.b59fda09.js"><link rel="prefetch" href="/assets/js/14.99c9b508.js"><link rel="prefetch" href="/assets/js/15.9dff8df1.js"><link rel="prefetch" href="/assets/js/16.0718f125.js"><link rel="prefetch" href="/assets/js/17.e0464496.js"><link rel="prefetch" href="/assets/js/18.18957a8d.js"><link rel="prefetch" href="/assets/js/19.3873cda5.js"><link rel="prefetch" href="/assets/js/20.a25f0082.js"><link rel="prefetch" href="/assets/js/3.f28e76ee.js"><link rel="prefetch" href="/assets/js/4.bd1f08ae.js"><link rel="prefetch" href="/assets/js/5.a4018245.js"><link rel="prefetch" href="/assets/js/7.cbc31171.js"><link rel="prefetch" href="/assets/js/8.b5760b33.js"><link rel="prefetch" href="/assets/js/9.c643aa64.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fdde5c9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">EMPTY916</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Natur" class="dropdown-title"><span class="title">Natur</span> <span class="arrow down"></span></button> <button type="button" aria-label="Natur" class="mobile-dropdown-title"><span class="title">Natur</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  natur
</a></li><li class="dropdown-item"><!----> <a href="/natur/api.html" class="nav-link">
  natur api
</a></li><li class="dropdown-item"><!----> <a href="/natur-service/" class="nav-link">
  natur-service
</a></li><li class="dropdown-item"><!----> <a href="/natur-persist/" class="nav-link">
  natur-persist
</a></li><li class="dropdown-item"><!----> <a href="/natur-persist-async/" class="nav-link">
  natur-persist-async
</a></li><li class="dropdown-item"><!----> <a href="/umi-natur/" class="nav-link">
  umi-natur
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/empty916" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Natur" class="dropdown-title"><span class="title">Natur</span> <span class="arrow down"></span></button> <button type="button" aria-label="Natur" class="mobile-dropdown-title"><span class="title">Natur</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  natur
</a></li><li class="dropdown-item"><!----> <a href="/natur/api.html" class="nav-link">
  natur api
</a></li><li class="dropdown-item"><!----> <a href="/natur-service/" class="nav-link">
  natur-service
</a></li><li class="dropdown-item"><!----> <a href="/natur-persist/" class="nav-link">
  natur-persist
</a></li><li class="dropdown-item"><!----> <a href="/natur-persist-async/" class="nav-link">
  natur-persist-async
</a></li><li class="dropdown-item"><!----> <a href="/umi-natur/" class="nav-link">
  umi-natur
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/empty916" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>natur cook book</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/natur/#introduction" class="sidebar-link">introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/natur/#start" class="sidebar-link">start</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/natur/#design" class="sidebar-link">design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natur/#the-flow-of-a-store-module" class="sidebar-link">the flow of a store module</a></li><li class="sidebar-sub-header"><a href="/natur/#store-module-management" class="sidebar-link">store module management</a></li></ul></li><li><a href="/natur/#simple-demo" class="sidebar-link">simple demo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natur/#declare-a-module" class="sidebar-link">declare a module</a></li><li class="sidebar-sub-header"><a href="/natur/#create-store-and-inject" class="sidebar-link">create store and inject</a></li><li class="sidebar-sub-header"><a href="/natur/#use-in-react" class="sidebar-link">use in React</a></li></ul></li><li><a href="/natur/#detailed-module" class="sidebar-link">detailed module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natur/#state-storing-data" class="sidebar-link">state — Storing Data</a></li><li class="sidebar-sub-header"><a href="/natur/#maps-computed-properties" class="sidebar-link">maps — Computed Properties</a></li><li class="sidebar-sub-header"><a href="/natur/#actions-updating-data" class="sidebar-link">actions — Updating Data</a></li></ul></li><li><a href="/natur/#usecase" class="sidebar-link">usecase</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natur/#synchronous-update-data" class="sidebar-link">synchronous update data</a></li><li class="sidebar-sub-header"><a href="/natur/#asynchronous-update-data" class="sidebar-link">asynchronous update data</a></li><li class="sidebar-sub-header"><a href="/natur/#update-data-asynchronously-in-multiple-batches" class="sidebar-link">update data asynchronously in multiple batches</a></li><li class="sidebar-sub-header"><a href="/natur/#get-the-latest-state-and-maps-value-in-actions" class="sidebar-link">get the latest state and maps value in actions</a></li><li class="sidebar-sub-header"><a href="/natur/#call-other-actions-in-actions" class="sidebar-link">call other actions in actions</a></li><li class="sidebar-sub-header"><a href="/natur/#the-component-only-listens-to-changes-in-some-data" class="sidebar-link">the component only listens to changes in some data</a></li><li class="sidebar-sub-header"><a href="/natur/#lazy-loading-module-configuration" class="sidebar-link">lazy loading module configuration</a></li><li class="sidebar-sub-header"><a href="/natur/#initialization-state" class="sidebar-link">initialization state</a></li><li class="sidebar-sub-header"><a href="/natur/#complex-business-scenarios-of-cross-module-interaction" class="sidebar-link">complex business scenarios of cross-module interaction</a></li><li class="sidebar-sub-header"><a href="/natur/#placeholder-component-configuration-when-loading" class="sidebar-link">placeholder component configuration when loading</a></li><li class="sidebar-sub-header"><a href="/natur/#use-natur-outside-react" class="sidebar-link">use natur outside react</a></li><li class="sidebar-sub-header"><a href="/natur/#dispatch" class="sidebar-link">dispatch</a></li><li class="sidebar-sub-header"><a href="/natur/#importing-modules-manually" class="sidebar-link">importing modules manually</a></li></ul></li><li><a href="/natur/#interceptor" class="sidebar-link">interceptor</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/natur/#middleware" class="sidebar-link">middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natur/#built-in-middleware-description" class="sidebar-link">built-in middleware description</a></li><li class="sidebar-sub-header"><a href="/natur/#recommended-middleware-configuration" class="sidebar-link">recommended middleware configuration</a></li></ul></li><li><a href="/natur/#typescript-support" class="sidebar-link">typescript support</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/natur/#base-usage" class="sidebar-link">base usage</a></li><li class="sidebar-sub-header"><a href="/natur/#redefine-store-type" class="sidebar-link">Redefine store type</a></li></ul></li><li><a href="/natur/#cautions" class="sidebar-link">cautions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/natur/#plugins" class="sidebar-link">plugins</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="natur-cook-book"><a href="#natur-cook-book" class="header-anchor">#</a> natur cook book</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> introduction</h2> <ol><li>This is a simple and efficient react state manager</li> <li>Good typescript experience</li> <li>Browser compatible: IE8+</li> <li>support react and anujs</li> <li>Unit test coverage rate of 99%, rest assured to use</li> <li>minizipped size 5k</li></ol> <h2 id="start"><a href="#start" class="header-anchor">#</a> start</h2> <ol><li>open your react project</li> <li>install <strong>natur</strong></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># npm install natur -S</span>
<span class="token function">yarn</span> <span class="token function">add</span> natur
</code></pre></div><h2 id="design"><a href="#design" class="header-anchor">#</a> design</h2> <h3 id="the-flow-of-a-store-module"><a href="#the-flow-of-a-store-module" class="header-anchor">#</a> the flow of a store module</h3> <p><img src="/assets/img/process.8a0fba9e.png" alt="store module"></p> <h3 id="store-module-management"><a href="#store-module-management" class="header-anchor">#</a> store module management</h3> <p><strong>natur itself is a module manager, plus publish and subscribe</strong></p> <p><img src="/assets/img/natur.c3250491.png" alt="store"></p> <h2 id="simple-demo"><a href="#simple-demo" class="header-anchor">#</a> simple demo</h2> <p><a href="https://codesandbox.io/s/natur-2x-simple-demo-nx0pp?file=/src/App.tsx" target="_blank" rel="noopener noreferrer">codesandbox<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="declare-a-module"><a href="#declare-a-module" class="header-anchor">#</a> declare a module</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// save data</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// map of state</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span> 
    isEven<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// actions is used to update state</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="create-store-and-inject"><a href="#create-store-and-inject" class="header-anchor">#</a> create store and inject</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> createInject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> inject <span class="token operator">=</span> <span class="token function">createInject</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">storeGetter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="use-in-react"><a href="#use-in-react" class="header-anchor">#</a> use in React</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// create an injector of count module</span>
<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// declare props type</span>
<span class="token class-name"><span class="token keyword">const</span></span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token keyword">typeof</span> injector<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">dec</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>count<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>count<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>isEven<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// inject count module into App component by injector</span>
<span class="token keyword">const</span> IApp <span class="token operator">=</span> <span class="token function">injector</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// render injected component</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IApp</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="detailed-module"><a href="#detailed-module" class="header-anchor">#</a> detailed module</h2> <p><strong>A module consists of state, maps, actions</strong></p> <h3 id="state-storing-data"><a href="#state-storing-data" class="header-anchor">#</a> state — Storing Data</h3> <ul><li><strong>required:</strong><code>true</code></li> <li><strong>type:</strong><code>any</code></li> <li>state is used to store data</li></ul> <h3 id="maps-computed-properties"><a href="#maps-computed-properties" class="header-anchor">#</a> maps — Computed Properties</h3> <ul><li><p><strong>required:</strong><code>false</code></p></li> <li><p><strong>type:</strong><code>{[map: string]: Array&lt;string|Function&gt; | Function;}</code></p></li> <li><p>maps is a map of state data, and its member must be an array of function. Let's call it map for now.</p></li> <li><p>if the map is an array, the preceding elements are all declaring the dependency of this map on the state. The last function can get the dependency declared earlier, and you can implement the calculation logic you need in it. On the component, you can get the result of the last function of the array.</p></li> <li><p>if the map is a function, then it can only accept state as an input parameter, or there is no parameter. If it is a state as a parameter, then when the state is updated, the map must be re-executed and there is no cache. If the map has no parameters, then this map will only be executed once</p></li> <li><p>the results of maps are cached. If the value of the dependencies you declare does not change, the last function will not be re-executed.</p></li> <li><p>When do I need to manually declare dependencies? If your map logic is more complicated, or the return value of your map is not a basic type value and needs to be rendered to the component, then you can consider manually declaring dependencies to ensure performance. Generally, you can use the function directly.</p></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// The elements in front of the array are all declaring the dependency of this map on state. The last function can get the previously declared dependencies. You can implement what you want in it.</span>
    sum1<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">+</span> value<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// You can also declare dependencies as functions, which is useful for complex types of state</span>
    sum2<span class="token operator">:</span> <span class="token punctuation">[</span>state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">,</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">+</span> value<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// It can also be a function that directly depends on the entire state. The disadvantage is that the function will be re-executed as long as the state is updated, and there is no cache.</span>
    <span class="token function-variable function">sum3</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">+</span> value<span class="token punctuation">,</span>
    <span class="token comment">// It can also be a function, no dependencies, only executed once</span>
    <span class="token function-variable function">isTrue</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * the demo module data you got at component is
 * demo: {
 *  state: {
 *    number: 1,
 *    value: 2,
 *  }
 *  maps: {
 *    sum1: 3,
 *    sum2: 3,
 *    sum3: 3,
 *    isTrue: true
 *  }
 * ...
 * }
 */</span>
</code></pre></div><h3 id="actions-updating-data"><a href="#actions-updating-data" class="header-anchor">#</a> actions — Updating Data</h3> <ul><li><strong>required:</strong><code>true</code></li> <li><strong>type:</strong><code>{[action: string]: (...arg: any[]) =&gt; any;}</code></li> <li>The member of actions must be functions. If no middleware is set, any data it returns will be used as the new state, and the react components using this module will be notified to update, which is done inside natur.</li> <li>actions must follow the immutable specification!</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Actions</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Actions are used to modify the state. The data it returns will be used as the new state (this part is done internally by natur)</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="usecase"><a href="#usecase" class="header-anchor">#</a> usecase</h2> <h3 id="synchronous-update-data"><a href="#synchronous-update-data" class="header-anchor">#</a> synchronous update data</h3> <ul><li>here we use the <a href="#recommended-middleware-configuration">officially recommended middleware configuration</a> by default, please see the middleware section for details</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// here is the synchronous update of the name data in the state</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="asynchronous-update-data"><a href="#asynchronous-update-data" class="header-anchor">#</a> asynchronous update data</h3> <ul><li>here we use the <a href="#recommended-middleware-configuration">officially recommended middleware configuration</a> by default, please see the middleware section for details</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// here is the asynchronous update of the name data in the state</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="update-data-asynchronously-in-multiple-batches"><a href="#update-data-asynchronously-in-multiple-batches" class="header-anchor">#</a> update data asynchronously in multiple batches</h3> <ul><li>here we use the <a href="#recommended-middleware-configuration">officially recommended middleware configuration</a> by default, please see the middleware section for details</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;natur/dist/middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  now<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// here is the asynchronous multi-batch update of the name data in the state</span>
  <span class="token function-variable function">updateNow</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>setState<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> state<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// update the value of now every second</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>now<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="get-the-latest-state-and-maps-value-in-actions"><a href="#get-the-latest-state-and-maps-value-in-actions" class="header-anchor">#</a> get the latest state and maps value in actions</h3> <ul><li>here we use the <a href="#recommended-middleware-configuration">officially recommended middleware configuration</a> by default, please see the middleware section for details</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;natur/dist/middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> maps <span class="token operator">=</span> <span class="token punctuation">{</span>
  nameIsTome<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> name <span class="token operator">===</span> <span class="token string">'tom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">updateName</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>getState<span class="token punctuation">,</span> getMaps<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> state<span class="token punctuation">,</span> <span class="token keyword">typeof</span> maps<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// get the latest state value</span>
    <span class="token keyword">const</span> currentState <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// get the latest maps value</span>
    <span class="token keyword">const</span> currentMaps <span class="token operator">=</span> <span class="token function">getMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  maps<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="call-other-actions-in-actions"><a href="#call-other-actions-in-actions" class="header-anchor">#</a> call other actions in actions</h3> <ul><li>here we use the <a href="#recommended-middleware-configuration">officially recommended middleware configuration</a> by default, please see the middleware section for details</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;natur/dist/middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">loading</span><span class="token operator">:</span> <span class="token punctuation">(</span>loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// This is the action that calls loading</span>
  <span class="token function-variable function">fetchData</span><span class="token operator">:</span> <span class="token punctuation">(</span>newName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// call loading method</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// you can also call actions of other modules, but it is not recommended to use them widely</span>
    <span class="token comment">// dispatch('otherModule/actions', /* ...arguments */);</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> newName<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="the-component-only-listens-to-changes-in-some-data"><a href="#the-component-only-listens-to-changes-in-some-data" class="header-anchor">#</a> the component only listens to changes in some data</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'your-inject'</span><span class="token punctuation">;</span>

<span class="token comment">// Here the App component will only listen to changes in the name of the app and state. Changes in other values will not cause updates to the App component</span>
<span class="token keyword">let</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// You can also use function declarations state: [s =&gt; s.name]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Here the App component only listens to changes in the app and the map's deepDep. Changes in other values will not cause updates to the App component</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'deepDep'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// or</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'deepDep'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// Here the App component will not be updated regardless of any changes in the app module</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or </span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// Because actions stay the same after they are created, you don't have to listen for changes</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>app<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token keyword">typeof</span> injector<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// get app module</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> maps<span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input
      value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token comment">// state in app</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> actions<span class="token punctuation">.</span><span class="token function">changeName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// complex demo</span>
<span class="token keyword">let</span> complexInjector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>xxx<span class="token punctuation">]</span><span class="token punctuation">,</span> maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xxx'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
complexInjector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'other'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>xxx<span class="token punctuation">]</span><span class="token punctuation">,</span> maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xxx'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="lazy-loading-module-configuration"><a href="#lazy-loading-module-configuration" class="header-anchor">#</a> lazy loading module configuration</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/*
  module1.js
  export {
    state: {
      count: 1,
    }
    actions: {
      inc: state =&gt; ({count: state.count + 1}),
    }
  }
  
*/</span>
<span class="token keyword">const</span> otherLazyModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// module2: () =&gt; import('module2');</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">module1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lazy loading module</span>

<span class="token comment">// Create a store instance</span>
<span class="token comment">// The second parameter is the lazy loaded module;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> module1<span class="token punctuation">,</span> <span class="token operator">...</span>otherLazyModules <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Then the usage is equivalent to the second step</span>
</code></pre></div><h3 id="initialization-state"><a href="#initialization-state" class="header-anchor">#</a> initialization state</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncChangeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
  createStore third parameter
  {
    [moduleName: ModuleName]: Require&lt;State&gt;,
  }
*/</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> 
    initStates<span class="token operator">:</span> <span class="token punctuation">{</span>
      app<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'jerry'</span><span class="token punctuation">}</span> <span class="token comment">// Initialize the state of the app module</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><h3 id="complex-business-scenarios-of-cross-module-interaction"><a href="#complex-business-scenarios-of-cross-module-interaction" class="header-anchor">#</a> complex business scenarios of cross-module interaction</h3> <blockquote><p>In complex business scenarios, there are usually scenarios where multiple modules monitor and call each other, so for this scenario, you can use <a href="/natur-service/">natur-service</a> Non-intrusive solution, you can monitor any changes in the module, and non-invasive development of complex business logic, while retaining the simplicity and maintainability of each module.</p></blockquote> <hr> <h3 id="placeholder-component-configuration-when-loading"><a href="#placeholder-component-configuration-when-loading" class="header-anchor">#</a> placeholder component configuration when loading</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createInject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token comment">// Global configuration</span>
<span class="token keyword">const</span> inject <span class="token operator">=</span> <span class="token function">createInject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">storeGetter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">,</span>
  <span class="token function-variable function">loadingComponent</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Local use</span>
<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">loading</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="use-natur-outside-react"><a href="#use-natur-outside-react" class="header-anchor">#</a> use natur outside react</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Store instance created before</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'my-store-instance'</span><span class="token punctuation">;</span>

<span class="token comment">/*
  Get the registered app module, which is equivalent to the app module obtained in the react component
  If you want to get lazy loaded modules,
  Then you have to make sure that the module is already loaded at this time
*/</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  If you are sure, lazy load the module, not loaded yet
  You can listen for lazy loading modules and get
*/</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> lazyModule <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
state: {
  name: 'tom'
},
actions: {
  changeName,
  asyncChangeName,
},
maps: {
  splitName: ['t', 'o', 'm'],
  addName: lastName =&gt; state.name + lastName,
}
*/</span>
<span class="token comment">/*
  When you use the action method to update the state here,
  All components injected into the app module will be updated,
  And get the data in the latest app module,
  Advised not to abuse
*/</span>
app<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">changeName</span><span class="token punctuation">(</span><span class="token string">'jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Equivalent to</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'changeName'</span><span class="token punctuation">,</span> <span class="token string">'jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Monitoring module changes</span>
<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Here you can get the latest app data</span>
  store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Cancel listening</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="dispatch"><a href="#dispatch" class="header-anchor">#</a> dispatch</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> InjectStoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span>
    isEven<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>actions<span class="token punctuation">,</span> state<span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span>

actions<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Equivalent to</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'inc'</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="importing-modules-manually"><a href="#importing-modules-manually" class="header-anchor">#</a> importing modules manually</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token comment">// initStore.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token comment">// When instantiating the store, no lazy loading module was imported</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">/*...modules*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ================================================</span>
<span class="token comment">// lazyloadPage.ts This is a lazy loaded page</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'initStore.ts'</span>

<span class="token keyword">const</span> lazyLoadModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">nameSplit</span><span class="token operator">:</span> state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">addName</span><span class="token operator">:</span> state <span class="token operator">=&gt;</span> lastName <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name <span class="token operator">+</span> lastName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
Add the module manually, it cannot be used anywhere else until it is added
To use it elsewhere, it must be imported when the store is instantiated
*/</span>
store<span class="token punctuation">.</span><span class="token function">setModule</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">,</span> lazyLoadModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">lazyLoadView</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Now you can get manually added modules</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> maps<span class="token punctuation">,</span> actions<span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="interceptor"><a href="#interceptor" class="header-anchor">#</a> interceptor</h2> <p><strong>When the module calls action or store.dispatch, it will pass the interceptor first, so the interceptor can be applied to control whether the action is executed, and the input parameter control of the action</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  createStore<span class="token punctuation">,</span>
  Interceptor
  InterceptorActionRecord<span class="token punctuation">,</span>
  InterceptorNext<span class="token punctuation">,</span>
  InterceptorParams<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncChangeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">InterceptorActionRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  moduleName<span class="token operator">:</span> String<span class="token punctuation">;</span>
  actionName<span class="token operator">:</span> String<span class="token punctuation">;</span>
  actionArgs<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function-variable function">actionFunc</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>arg<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// The original action function</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">InterceptorNext</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">record<span class="token operator">:</span> InterceptorActionRecord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// The InterceptorParams type is the same as the MiddlewareParams type</span>

<span class="token keyword">type</span> <span class="token class-name">InterceptorParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  setState<span class="token operator">:</span> MiddlewareNext<span class="token punctuation">,</span> 
  <span class="token function-variable function">getState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> State<span class="token punctuation">,</span>
  <span class="token function-variable function">getMaps</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> InjectMaps<span class="token punctuation">,</span>
  <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> LogInterceptor<span class="token operator">:</span> Interceptor<span class="token operator">&lt;</span><span class="token keyword">typeof</span> store<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">interceptorParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token punctuation">(</span><span class="token parameter">next<span class="token operator">:</span> InterceptorNext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">(</span><span class="token parameter">record<span class="token operator">:</span> InterceptorActionRecord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>actionName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> record<span class="token punctuation">.</span>actionArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// You should return</span>
    <span class="token comment">// only then will you have the return value when you call the action on the page</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    interceptors<span class="token operator">:</span> <span class="token punctuation">[</span>LogInterceptor<span class="token punctuation">,</span> <span class="token comment">/* ...moreInterceptor */</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><h2 id="middleware"><a href="#middleware" class="header-anchor">#</a> middleware</h2> <p><strong>The execution of the middleware occurs after the action is executed and before the state is updated. Can receive the return value of the action, generally can be applied to the processing of the return value of the action, the control of state update, etc.</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> MiddleWare<span class="token punctuation">,</span> MiddlewareNext<span class="token punctuation">,</span> MiddlewareActionRecord <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncChangeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">MiddlewareActionRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  moduleName<span class="token operator">:</span> String<span class="token punctuation">,</span>
  actionName<span class="token operator">:</span> String<span class="token punctuation">,</span>
  state<span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">MiddlewareNext</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">record<span class="token operator">:</span> MiddlewareActionRecord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">MiddlewareParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  setState<span class="token operator">:</span> MiddlewareNext<span class="token punctuation">,</span> 
  <span class="token function-variable function">getState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> State<span class="token punctuation">,</span>
  <span class="token function-variable function">getMaps</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> InjectMaps<span class="token punctuation">,</span>
  <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> LogMiddleware<span class="token operator">:</span> MiddleWare<span class="token operator">&lt;</span><span class="token keyword">typeof</span> store<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">middlewareParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token punctuation">(</span><span class="token parameter">next<span class="token operator">:</span> MiddlewareNext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">(</span><span class="token parameter">record<span class="token operator">:</span> MiddlewareActionRecord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>actionName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> record<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// You should return, only then will you have a return value when the page calls the action</span>
    <span class="token comment">// return middlewareParams.setState(record); // You should return, only then will you have a return value when the page calls the action</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    middlewares<span class="token operator">:</span><span class="token punctuation">[</span>LogMiddleware<span class="token punctuation">,</span> <span class="token comment">/* ...moreMiddleware */</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><h3 id="built-in-middleware-description"><a href="#built-in-middleware-description" class="header-anchor">#</a> built-in middleware description</h3> <ul><li>thunkMiddleware: Due to the runtime closure problem within the component, the latest state cannot be obtained, so all this middleware exists</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> thunkMiddleware<span class="token punctuation">,</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur/dist/middlewares'</span>

<span class="token keyword">const</span> <span class="token function-variable function">actionExample</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myParams<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  getState<span class="token punctuation">,</span> 
  setState<span class="token punctuation">,</span> 
  getMaps<span class="token punctuation">,</span>
  dispatch<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> stateOfThisModule<span class="token punctuation">,</span> <span class="token keyword">typeof</span> mapsOfThisModule<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentState <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get latest state</span>
  <span class="token keyword">const</span> currentMaps <span class="token operator">=</span> <span class="token function">getMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get latest maps</span>
  <span class="token comment">// dispatch('otherActionNameOfThisModule', ...params)</span>
  <span class="token comment">// dispatch('otherModuleName/otherActionNameOfOtherModule', ...params);</span>
  <span class="token function">setState</span><span class="token punctuation">(</span>currentState<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// update state</span>
  <span class="token keyword">return</span> currentState<span class="token punctuation">;</span> <span class="token comment">// update state too</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>promiseMiddleware: action supports asynchronous operations</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">action1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">action2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">2333</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>fillObjectRestDataMiddleware: Incremental state update / overwrite update, only valid when state is an object</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// Call this action, the final state is {a: 11, b: 2}, this middleware requires that the data returned by the state and action must be ordinary objects</span>
</code></pre></div><ul><li>shallowEqualMiddleware：Shallow comparison optimization middleware, limited to the state of ordinary objects</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Same as the old state, do not update the view</span>
</code></pre></div><ul><li>filterUndefinedMiddleware: Interceptor actions that return undefined</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// The return of this action will not be used as the new state</span>
</code></pre></div><ul><li>devtool</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code>
<span class="token comment">// redux.devtool.middleware.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> Object <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> actions<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span>Object <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>state<span class="token punctuation">,</span>
  <span class="token operator">...</span>actions<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> createMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Middleware <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> devMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> devMiddleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>getState<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> next <span class="token operator">=&gt;</span> record <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>actionName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        state<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token punctuation">[</span>record<span class="token punctuation">.</span>moduleName<span class="token punctuation">]</span><span class="token operator">:</span> record<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> next <span class="token operator">=&gt;</span> record <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="recommended-middleware-configuration"><a href="#recommended-middleware-configuration" class="header-anchor">#</a> recommended middleware configuration</h3> <p><strong>Note: The order of middleware configuration is important</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  thunkMiddleware<span class="token punctuation">,</span>
  promiseMiddleware<span class="token punctuation">,</span> 
  fillObjectRestDataMiddleware<span class="token punctuation">,</span>
  shallowEqualMiddleware<span class="token punctuation">,</span> 
  filterUndefinedMiddleware<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur/dist/middlewares'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> devTool <span class="token keyword">from</span> <span class="token string">'redux.devtool.middleware'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  modules<span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    middlewares<span class="token operator">:</span> <span class="token punctuation">[</span>
      thunkMiddleware<span class="token punctuation">,</span> <span class="token comment">// Action supports returning functions and getting the latest data</span>
      promiseMiddleware<span class="token punctuation">,</span> <span class="token comment">// action supports asynchronous operations</span>
      fillObjectRestDataMiddleware<span class="token punctuation">,</span> <span class="token comment">// Incremental state update / overwrite update</span>
      shallowEqualMiddleware<span class="token punctuation">,</span> <span class="token comment">// Shallow contrast optimization between old and new state</span>
      filterUndefinedMiddleware<span class="token punctuation">,</span> <span class="token comment">// Interceptor actions with no return value</span>
      devTool<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="typescript-support"><a href="#typescript-support" class="header-anchor">#</a> typescript support</h2> <h3 id="base-usage"><a href="#base-usage" class="header-anchor">#</a> base usage</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> inject <span class="token keyword">from</span> <span class="token string">'your-inject'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ModuleType<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 存放数据</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// state的映射。比如，我需要知道state中的number是否是偶数</span>
    isEven<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 用来修改state。返回的数据会作为新的state(这部分由natur内部完成)</span>
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Generate the type obtained by the count module in the component</span>
<span class="token keyword">type</span> <span class="token class-name">InjectCountType</span> <span class="token operator">=</span> ModuleType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> count<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">otherProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  className<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  style<span class="token operator">:</span> Object<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span><span class="token keyword">typeof</span> injector<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">&amp;</span> otherProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> maps<span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> actions<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> actions<span class="token punctuation">.</span><span class="token function">dec</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> IApp <span class="token operator">=</span> <span class="token function">injector</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>IApp className<span class="token operator">=</span><span class="token string">'1'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  app<span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="redefine-store-type"><a href="#redefine-store-type" class="header-anchor">#</a> Redefine store type</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Store<span class="token punctuation">,</span> createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">lazyModule1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allSyncModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">,</span>
  <span class="token comment">/* and others */</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> allAsyncModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  lazyModule1<span class="token punctuation">,</span>
  <span class="token comment">/* and others */</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>allSyncModules<span class="token punctuation">,</span> allAsyncModules<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">StoreInsType</span> <span class="token operator">=</span> Store<span class="token operator">&lt;</span><span class="token keyword">typeof</span> allSyncModules<span class="token punctuation">,</span> <span class="token keyword">typeof</span> allAsyncModules<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// The type of StoreInsType is the type of store, you can extend your type</span>
</code></pre></div><h2 id="cautions"><a href="#cautions" class="header-anchor">#</a> cautions</h2> <ul><li><p>Because the lower version does not support the react.forwardRef method, you cannot directly use the ref to obtain the wrapped component instance. You need to use the forwardedRef property to obtain it (the usage is the same as ref).</p></li> <li><p>Tips in TypeScript may be less friendly, like</p></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// This usage method will report an error, indicating that there is no forwardedRef attribute declaration in the App component</span>
<span class="token operator">&lt;</span>App forwardedRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">// The following usage methods will not report an error</span>
<span class="token keyword">class</span> <span class="token class-name">_App</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_App<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// correct</span>
<span class="token operator">&lt;</span>App forwardedRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><ul><li><strong>To modify state in actions, you need to follow the immutable specification</strong></li></ul> <h2 id="plugins"><a href="#plugins" class="header-anchor">#</a> plugins</h2> <ul><li><a href="/natur-service">natur-service: natur upper scheduling library</a></li> <li><a href="/natur-persist">natur-persist: localStorage plugins</a></li> <li><a href="/natur-persist-async">natur-persist-async: async presit plugin</a></li> <li><a href="/umi-natur">umi-natur: umi plugin of natur</a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/23/2021, 8:51:17 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.57dfc609.js" defer></script><script src="/assets/js/2.e4845fa5.js" defer></script><script src="/assets/js/6.11836c2b.js" defer></script>
  </body>
</html>
