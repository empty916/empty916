<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>umi-natur | EMPTY916</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="empty916的站">
    
    <link rel="preload" href="/assets/css/0.styles.fdde5c9a.css" as="style"><link rel="preload" href="/assets/js/app.9d0f7809.js" as="script"><link rel="preload" href="/assets/js/2.e4845fa5.js" as="script"><link rel="preload" href="/assets/js/22.9f0a4796.js" as="script"><link rel="prefetch" href="/assets/js/10.74a039f6.js"><link rel="prefetch" href="/assets/js/11.1d2aa330.js"><link rel="prefetch" href="/assets/js/12.8b773188.js"><link rel="prefetch" href="/assets/js/13.1f068a17.js"><link rel="prefetch" href="/assets/js/14.4827724d.js"><link rel="prefetch" href="/assets/js/15.13557904.js"><link rel="prefetch" href="/assets/js/16.82652ebb.js"><link rel="prefetch" href="/assets/js/17.b9071a89.js"><link rel="prefetch" href="/assets/js/18.a56c9aac.js"><link rel="prefetch" href="/assets/js/19.00608bda.js"><link rel="prefetch" href="/assets/js/20.0f699001.js"><link rel="prefetch" href="/assets/js/21.e008bc9f.js"><link rel="prefetch" href="/assets/js/3.932f1f45.js"><link rel="prefetch" href="/assets/js/4.bd1f08ae.js"><link rel="prefetch" href="/assets/js/5.a4018245.js"><link rel="prefetch" href="/assets/js/6.663f28d5.js"><link rel="prefetch" href="/assets/js/7.711a91fa.js"><link rel="prefetch" href="/assets/js/8.b5760b33.js"><link rel="prefetch" href="/assets/js/9.2b283bae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fdde5c9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">EMPTY916</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Natur" class="dropdown-title"><span class="title">Natur</span> <span class="arrow down"></span></button> <button type="button" aria-label="Natur" class="mobile-dropdown-title"><span class="title">Natur</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/natur/" class="nav-link">
  natur
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/api.html" class="nav-link">
  natur api
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-service/" class="nav-link">
  natur-service
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist/" class="nav-link">
  natur-persist
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist-async/" class="nav-link">
  natur-persist-async
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-immer/" class="nav-link">
  natur-immer
</a></li><li class="dropdown-item"><!----> <a href="/zh/umi-natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  umi-natur
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/empty916" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/umi-natur/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/umi-natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Natur" class="dropdown-title"><span class="title">Natur</span> <span class="arrow down"></span></button> <button type="button" aria-label="Natur" class="mobile-dropdown-title"><span class="title">Natur</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/natur/" class="nav-link">
  natur
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/api.html" class="nav-link">
  natur api
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-service/" class="nav-link">
  natur-service
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist/" class="nav-link">
  natur-persist
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist-async/" class="nav-link">
  natur-persist-async
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-immer/" class="nav-link">
  natur-immer
</a></li><li class="dropdown-item"><!----> <a href="/zh/umi-natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  umi-natur
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/empty916" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/umi-natur/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/umi-natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>umi-natur</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/umi-natur/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#版本对照" class="sidebar-link">版本对照</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#普通使用方式" class="sidebar-link">普通使用方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#ssr使用场景" class="sidebar-link">ssr使用场景</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#使用service" class="sidebar-link">使用service</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#natur" class="sidebar-link">natur</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/umi-natur/#dirname" class="sidebar-link">dirName</a></li><li class="sidebar-sub-header"><a href="/zh/umi-natur/#issyncmodule" class="sidebar-link">isSyncModule</a></li><li class="sidebar-sub-header"><a href="/zh/umi-natur/#interceptors" class="sidebar-link">interceptors</a></li><li class="sidebar-sub-header"><a href="/zh/umi-natur/#middlewares" class="sidebar-link">middlewares</a></li></ul></li><li><a href="/zh/umi-natur/#persist" class="sidebar-link">persist</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#useimmer" class="sidebar-link">useImmer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/umi-natur/#service" class="sidebar-link">service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/umi-natur/#dirname-2" class="sidebar-link">dirName</a></li><li class="sidebar-sub-header"><a href="/zh/umi-natur/#superclassname" class="sidebar-link">superClassName</a></li><li class="sidebar-sub-header"><a href="/zh/umi-natur/#ignore" class="sidebar-link">ignore</a></li></ul></li><li><a href="/zh/umi-natur/#license" class="sidebar-link">LICENSE</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="umi-natur"><a href="#umi-natur" class="header-anchor">#</a> umi-natur</h1> <ul><li>自动生成 natur 代码的 umi 插件，超级好用</li> <li>支持自动配置natur</li> <li>支持自动扫描natur模块代码并导入</li> <li>支持ssr场景</li> <li>支持自动扫描service代码，并自动配置，同样servcie也可以应用于ssr场景</li> <li>支持persist配置</li> <li>支持immer插件</li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># or npm install umi-natur -D</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> umi-natur -D

<span class="token comment"># or npm install natur -S</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> natur
</code></pre></div><h2 id="版本对照"><a href="#版本对照" class="header-anchor">#</a> 版本对照</h2> <table><thead><tr><th>umi-natur</th> <th>umi</th></tr></thead> <tbody><tr><td>1.x</td> <td>3.x</td></tr> <tr><td>2.x</td> <td>4.x</td></tr></tbody></table> <h2 id="普通使用方式"><a href="#普通使用方式" class="header-anchor">#</a> 普通使用方式</h2> <ol><li>首先添加配置<code>.umirc.ts</code>,</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 配置natur插件到umi</span>
    <span class="token string">'umi-natur'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  natur<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>创建你的natur模块
<code>store/count.ts</code></li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span>newState<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> newState<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  actions<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> count<span class="token punctuation">;</span>

</code></pre></div><ol start="3"><li>使用你的模块</li></ol> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token keyword">typeof</span> injector<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>count<span class="token punctuation">.</span>state<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">injector</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ssr使用场景"><a href="#ssr使用场景" class="header-anchor">#</a> ssr使用场景</h2> <div class="custom-block tip"><p class="custom-block-title">最低版本要求</p> <p>umi &gt;= 3.4.14<br>
umi-natur &gt;= 1.1.1</p></div> <p><code>.umirc.ts</code>配置文件</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'umi-natur'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  ssr<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  natur<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>示例页面<code>index.tsx</code></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject<span class="token punctuation">,</span> Store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'aModule'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>aModule<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token keyword">typeof</span> injector<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 客户端执行一个action</span>
    aModule<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">aAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

App<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>store<span class="token operator">:</span> Store<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 服务端执行一个action，这里的代码不会在客户端执行，所以你要在客户端重复执行一次</span>
  <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'aModule'</span><span class="token punctuation">,</span> <span class="token string">'aAction'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 必须把数据返回给客户端使用</span>
  <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">getAllStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">injector</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="使用service"><a href="#使用service" class="header-anchor">#</a> 使用service</h2> <ol><li>添加service配置
<code>.umirc.ts</code></li></ol> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'umi-natur'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  natur<span class="token operator">:</span> <span class="token punctuation">{</span>
    service<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>创建service模块
<code>service/count2</code></li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BaseService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token comment">// 这里表示count2模块会监听count的变动，然后同步count的state到自己的state</span>
<span class="token comment">// 类名必须是大写字母开头</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Count2Service</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里的代码是自动执行的， ssr模式下也是如此</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>state<span class="token punctuation">,</span> actionName<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionName <span class="token operator">===</span> <span class="token string">'update'</span> <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'count2'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">getCount2State</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'count2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>使用service模块</li></ol> <p><code>some.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 实例是小写字母开头的</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> count2Service <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@@/service'</span><span class="token punctuation">;</span>
count2Service<span class="token punctuation">.</span><span class="token function">getCount2State</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h1> <h2 id="natur"><a href="#natur" class="header-anchor">#</a> natur</h2> <ul><li><p><strong>类型：</strong><code>object</code></p></li> <li><p>插件默认会自动扫描store文件夹下面的文件, 如果是合法的natur模块被默认导出，那么会被插件捕捉到，并将导入代码生成在.umi/store下</p></li> <li><p>demo</p> <p><code>src/store/demo.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  actions<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>use-store-and-inject.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>store<span class="token punctuation">,</span> inject<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> demo <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>文件路径会被转化为模块名，例如：</p> <ul><li><code>src/store/modulea-list.ts</code>会转化为<code>moduleaList</code></li> <li><code>src/store/module_a/list/[id$].ts</code>会转化为<code>moduleAListId</code></li></ul></li></ul> <h3 id="dirname"><a href="#dirname" class="header-anchor">#</a> dirName</h3> <ul><li><strong>必填：</strong> <code>false</code></li> <li><strong>类型：</strong><code>string</code></li> <li><strong>默认值：</strong><code>'store'</code></li> <li>插件默认你的natur模块代码是写在store文件夹下的如果你的模块是写在其他文件夹下，你也可以修改，比如'pages'</li></ul> <h3 id="issyncmodule"><a href="#issyncmodule" class="header-anchor">#</a> isSyncModule</h3> <ul><li><strong>必填：</strong> <code>false</code></li> <li><strong>类型：</strong><code>(filePath: string) =&gt; boolean</code></li> <li>根据文件地址判断，这个模块是否同步模块, 不是同步模块就是异步模块</li></ul> <h3 id="interceptors"><a href="#interceptors" class="header-anchor">#</a> interceptors</h3> <ul><li><p><strong>必填：</strong> <code>false</code></p></li> <li><p><strong>类型：</strong><code>string</code></p></li> <li><p>你的interceptors文件地址</p></li> <li><p>这个文件地址必须是默认导出的函数</p></li> <li><p>这个函数的入参是一个获取store的函数，这个函数的返回值必须是一个intercepter数组</p></li> <li><p>demo</p> <p><code>.umirc.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'umi-natur'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  natur<span class="token operator">:</span> <span class="token punctuation">{</span>
    interceptors<span class="token operator">:</span> <span class="token string">'@/my-interceptors.ts'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>my-interceptors.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token function-variable function">getStore</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Store<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...your interceptors</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="middlewares"><a href="#middlewares" class="header-anchor">#</a> middlewares</h3> <ul><li><p><strong>必填：</strong> <code>false</code></p></li> <li><p><strong>类型：</strong><code>string</code></p></li> <li><p>你的middlewares文件地址</p></li> <li><p>这个文件地址必须是默认导出的函数</p></li> <li><p>这个函数的入参是一个获取store的函数，这个函数的返回值必须是一个middlewares数组</p></li> <li><p>一旦你自定义了中间件，那么默认的中间件会被移除，中间件的配置将完全由你决定</p></li> <li><p>demo</p> <p><code>.umirc.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'umi-natur'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  natur<span class="token operator">:</span> <span class="token punctuation">{</span>
    middlewares<span class="token operator">:</span> <span class="token string">'@/my-middlewares.ts'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>my-middlewares.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token function-variable function">getStore</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Store<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...your middlewares</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="persist"><a href="#persist" class="header-anchor">#</a> persist</h2> <ul><li><strong>必填：</strong> <code>false</code></li> <li><strong>类型：</strong> <code>object</code></li> <li>这个是持久化配置</li> <li>跟<a href="/zh/natur-persist">natur-persist</a>配置一样</li></ul> <h2 id="useimmer"><a href="#useimmer" class="header-anchor">#</a> useImmer</h2> <ul><li><strong>必填：</strong> <code>false</code></li> <li><strong>类型：</strong> <code>boolean</code></li> <li>这是是否开启<code>natur-immer</code>插件</li> <li>使用详情请看<a href="/zh/natur-immer/#使用">natur-immer</a></li></ul> <div class="custom-block tip"><p class="custom-block-title">最低版本要求</p> <p>umi-natur &gt;= 1.1.7</p></div> <h2 id="service"><a href="#service" class="header-anchor">#</a> service</h2> <ul><li><p><strong>必填：</strong> <code>false</code></p></li> <li><p><strong>类型：</strong> <code>object</code></p></li> <li><p>插件会扫描service文件夹下的代码，如果在这个文件夹下的文件，有Service类被默认导出, 那么Service实例化的代码会被自动生成在.umi/service下</p></li> <li><p>demo</p> <p><code>src/service/demo.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BaseService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">DemoService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispath</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token string">'action'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>use-service.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> demoService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@@/service'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> demo <span class="token operator">=</span> demoService<span class="token punctuation">.</span><span class="token function">getDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="dirname-2"><a href="#dirname-2" class="header-anchor">#</a> dirName</h3> <ul><li><strong>类型：</strong><code>string</code></li> <li><strong>默认值：</strong><code>'service'</code></li> <li>插件会扫描service文件夹下的代码，如果在这个文件夹下的文件，有Service类被默认导出</li> <li>那么Service实例化的代码会被自动生成在.umi/service下</li></ul> <h3 id="superclassname"><a href="#superclassname" class="header-anchor">#</a> superClassName</h3> <ul><li><strong>类型：</strong><code>string</code></li> <li><strong>默认值：</strong><code>'BaseService'</code></li> <li>识别是否是Service class的关键是，如果类是集成于BaseService，才会被导出</li> <li>同样，如果你是自己定义了一个Service基类，那么你也可以修改这个扫描配置</li></ul> <h3 id="ignore"><a href="#ignore" class="header-anchor">#</a> ignore</h3> <ul><li><strong>必填：</strong> <code>false</code></li> <li><strong>类型：</strong> <code>RegExp[]</code></li> <li>如果你并不想让某些Service类被自动生成代码，那么你可以配置忽略的类名</li></ul> <h2 id="license"><a href="#license" class="header-anchor">#</a> LICENSE</h2> <p>MIT</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2022/9/10 11:05:14</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9d0f7809.js" defer></script><script src="/assets/js/2.e4845fa5.js" defer></script><script src="/assets/js/22.9f0a4796.js" defer></script>
  </body>
</html>
