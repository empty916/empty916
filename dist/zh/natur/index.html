<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>natur 使用手册 | EMPTY916</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="empty916的站">
    
    <link rel="preload" href="/assets/css/0.styles.fdde5c9a.css" as="style"><link rel="preload" href="/assets/js/app.01c74c59.js" as="script"><link rel="preload" href="/assets/js/2.e4845fa5.js" as="script"><link rel="preload" href="/assets/js/7.8bff41c0.js" as="script"><link rel="prefetch" href="/assets/js/10.11357e15.js"><link rel="prefetch" href="/assets/js/11.1d2aa330.js"><link rel="prefetch" href="/assets/js/12.1901c72b.js"><link rel="prefetch" href="/assets/js/13.1f068a17.js"><link rel="prefetch" href="/assets/js/14.4435c0a6.js"><link rel="prefetch" href="/assets/js/15.6f4cacee.js"><link rel="prefetch" href="/assets/js/16.82652ebb.js"><link rel="prefetch" href="/assets/js/17.8154f16f.js"><link rel="prefetch" href="/assets/js/18.a56c9aac.js"><link rel="prefetch" href="/assets/js/19.ad3a5d86.js"><link rel="prefetch" href="/assets/js/20.0f699001.js"><link rel="prefetch" href="/assets/js/21.43c02f67.js"><link rel="prefetch" href="/assets/js/22.2db5db5d.js"><link rel="prefetch" href="/assets/js/3.932f1f45.js"><link rel="prefetch" href="/assets/js/4.bd1f08ae.js"><link rel="prefetch" href="/assets/js/5.a4018245.js"><link rel="prefetch" href="/assets/js/6.2c498fbd.js"><link rel="prefetch" href="/assets/js/8.b5760b33.js"><link rel="prefetch" href="/assets/js/9.2b283bae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fdde5c9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">EMPTY916</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Natur" class="dropdown-title"><span class="title">Natur</span> <span class="arrow down"></span></button> <button type="button" aria-label="Natur" class="mobile-dropdown-title"><span class="title">Natur</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  natur
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/api.html" class="nav-link">
  natur api
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-service/" class="nav-link">
  natur-service
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist/" class="nav-link">
  natur-persist
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist-async/" class="nav-link">
  natur-persist-async
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-immer/" class="nav-link">
  natur-immer
</a></li><li class="dropdown-item"><!----> <a href="/zh/umi-natur/" class="nav-link">
  umi-natur
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/empty916" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/natur/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Natur" class="dropdown-title"><span class="title">Natur</span> <span class="arrow down"></span></button> <button type="button" aria-label="Natur" class="mobile-dropdown-title"><span class="title">Natur</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  natur
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/api.html" class="nav-link">
  natur api
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-service/" class="nav-link">
  natur-service
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist/" class="nav-link">
  natur-persist
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-persist-async/" class="nav-link">
  natur-persist-async
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur-immer/" class="nav-link">
  natur-immer
</a></li><li class="dropdown-item"><!----> <a href="/zh/umi-natur/" class="nav-link">
  umi-natur
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/empty916" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/natur/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/natur/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>natur 使用手册</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/natur/#基本介绍" class="sidebar-link">基本介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/natur/#起步" class="sidebar-link">起步</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/natur/#设计" class="sidebar-link">设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#模块流程" class="sidebar-link">模块流程</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#模块管理" class="sidebar-link">模块管理</a></li></ul></li><li><a href="/zh/natur/#简单的示例" class="sidebar-link">简单的示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#声明模块" class="sidebar-link">声明模块</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#创建store和inject" class="sidebar-link">创建store和inject</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#在react中使用" class="sidebar-link">在React中使用</a></li></ul></li><li><a href="/zh/natur/#module详解" class="sidebar-link">module详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#state-存储数据" class="sidebar-link">state — 存储数据</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#maps-计算属性" class="sidebar-link">maps — 计算属性</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#actions-更新数据" class="sidebar-link">actions — 更新数据</a></li></ul></li><li><a href="/zh/natur/#应用场景" class="sidebar-link">应用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#注入多个模块" class="sidebar-link">注入多个模块</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#同步更新数据" class="sidebar-link">同步更新数据</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#异步更新数据" class="sidebar-link">异步更新数据</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#异步多批次更新数据" class="sidebar-link">异步多批次更新数据</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#在actions中获取最新的state-maps值" class="sidebar-link">在actions中获取最新的state，maps值</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#在actions中调用其他的action" class="sidebar-link">在actions中调用其他的action</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#组件只监听部分数据的变更" class="sidebar-link">组件只监听部分数据的变更</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#懒加载模块配置" class="sidebar-link">懒加载模块配置</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#初始化state" class="sidebar-link">初始化state</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#跨模块的交互的复杂业务场景" class="sidebar-link">跨模块的交互的复杂业务场景</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#加载时候的占位组件配置" class="sidebar-link">加载时候的占位组件配置</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#在react之外使用natur" class="sidebar-link">在react之外使用natur</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#手动导入模块" class="sidebar-link">手动导入模块</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#dispatch" class="sidebar-link">dispatch</a></li></ul></li><li><a href="/zh/natur/#拦截器" class="sidebar-link">拦截器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/natur/#中间件" class="sidebar-link">中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#内置中间件说明" class="sidebar-link">内置中间件说明</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#推荐的中间件配置" class="sidebar-link">推荐的中间件配置</a></li></ul></li><li><a href="/zh/natur/#typescript支持" class="sidebar-link">typescript支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#基础用法" class="sidebar-link">基础用法</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#重新定义store类型" class="sidebar-link">重新定义store类型</a></li></ul></li><li><a href="/zh/natur/#为什么选择natur" class="sidebar-link">为什么选择NATUR</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/natur/#系统设计理念" class="sidebar-link">系统设计理念</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#与redux对比" class="sidebar-link">与redux对比</a></li><li class="sidebar-sub-header"><a href="/zh/natur/#与mobx的对比" class="sidebar-link">与mobx的对比</a></li></ul></li><li><a href="/zh/natur/#使用注意事项" class="sidebar-link">使用注意事项</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/zh/natur/#插件" class="sidebar-link">插件</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="natur-使用手册"><a href="#natur-使用手册" class="header-anchor">#</a> natur 使用手册</h1> <h2 id="基本介绍"><a href="#基本介绍" class="header-anchor">#</a> 基本介绍</h2> <ol><li>这是一个简洁、高效的react状态管理器</li> <li>良好的typescript体验</li> <li>浏览器兼容：IE8+</li> <li>支持react, 以及anujs</li> <li>单元测试覆盖率99％，放心使用</li> <li>包体积，minizip 5k(uglify+gzip压缩后5k)</li></ol> <h2 id="起步"><a href="#起步" class="header-anchor">#</a> 起步</h2> <ol><li>打开你的react项目</li> <li>安装<code>natur</code></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> natur
<span class="token comment"># npm install natur -S</span>
</code></pre></div><h2 id="设计"><a href="#设计" class="header-anchor">#</a> 设计</h2> <h3 id="模块流程"><a href="#模块流程" class="header-anchor">#</a> 模块流程</h3> <p><img src="/assets/img/process.8a0fba9e.png" alt="模块"></p> <h3 id="模块管理"><a href="#模块管理" class="header-anchor">#</a> 模块管理</h3> <p><strong>natur本身是一个模块管理器，外加发布订阅</strong></p> <p><img src="/assets/img/natur.c3250491.png" alt="store"></p> <h2 id="简单的示例"><a href="#简单的示例" class="header-anchor">#</a> 简单的示例</h2> <p><a href="https://codesandbox.io/s/natur-2x-simple-demo-nx0pp?file=/src/App.tsx" target="_blank" rel="noopener noreferrer">在线体验<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="声明模块"><a href="#声明模块" class="header-anchor">#</a> 声明模块</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 存放数据</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// state的映射</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span> 
    isEven<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// actions用来修改state</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token parameter">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="创建store和inject"><a href="#创建store和inject" class="header-anchor">#</a> 创建store和inject</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> createInject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> inject <span class="token operator">=</span> <span class="token function">createInject</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">storeGetter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在react中使用"><a href="#在react中使用" class="header-anchor">#</a> 在React中使用</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 创建一个count模块的注入器</span>
<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 声明props类型</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token keyword">typeof</span> injector<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">dec</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>count<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>count<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>isEven<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 使用注入器向组件中注入count</span>
<span class="token keyword">const</span> IApp <span class="token operator">=</span> <span class="token function">injector</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染注入后的组件</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IApp</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="module详解"><a href="#module详解" class="header-anchor">#</a> module详解</h2> <p><strong>一个模块由state, maps, actions构成</strong></p> <h3 id="state-存储数据"><a href="#state-存储数据" class="header-anchor">#</a> state — 存储数据</h3> <ul><li><strong>必填：</strong><code>true</code></li> <li><strong>类型：</strong><code>any</code></li> <li>state用来存储数据</li></ul> <h3 id="maps-计算属性"><a href="#maps-计算属性" class="header-anchor">#</a> maps — 计算属性</h3> <ul><li><p><strong>必填：</strong><code>false</code></p></li> <li><p><strong>类型：</strong><code>{[map: string]: Array&lt;string|Function&gt; | Function;}</code></p></li> <li><p>maps是state数据的映射，它的成员必须是一个数组或者函数，我们暂且称其为map</p></li> <li><p>如果map是数组，前面的元素都是在声明此map对state的依赖项。最后一个函数可以获取前面声明的依赖，你可以在里面实现你需要的计算的逻辑。在组件中，你可以获取数组最后一个函数运行的结果。</p></li> <li><p>如果map是函数，那么它只能接受state作为入参，或者没有参数，如果是state作为参数，那么当state更新时，此map一定会重新执行，没有缓存。如果map没有参数，那么此map只会执行一次</p></li> <li><p>maps的结果是有缓存的，如果你声明的依赖项的值没有变化，那么最后一个函数便不会重新执行</p></li> <li><p>什么时候需要手动声明依赖？如果你的map逻辑较为复杂，或者你的map返回值不是基本类型的值，需要给到组件渲染，那么你可以考虑手动声明依赖，保证性能。一般直接使用函数的方式即可。</p></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 数组前面的元素，都是在声明此map对state的依赖项，最后一个函数可以获取前面声明的依赖，你可以在里面实现你想要的东西</span>
    sum1<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">+</span> value<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 你也可以通过函数的方式声明依赖项，这对于复杂类型的state很有用</span>
    sum2<span class="token operator">:</span> <span class="token punctuation">[</span>state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">,</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">+</span> value<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 也可以是个函数，直接依赖整个state，缺点是只要state更新就会重新执行函数，没有缓存</span>
    <span class="token function-variable function">sum3</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">+</span> value<span class="token punctuation">,</span>
    <span class="token comment">// 也可以是个函数，没有依赖，只执行一次</span>
    <span class="token function-variable function">isTrue</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 在组件中你获得的数据为
 * demo: {
 *  state: {
 *    number: 1,
 *    value: 2,
 *  }
 *  maps: {
 *    sum1: 3,
 *    sum2: 3,
 *    sum3: 3,
 *    isTrue: true
 *  }
 * ...
 * }
 */</span>
</code></pre></div><h3 id="actions-更新数据"><a href="#actions-更新数据" class="header-anchor">#</a> actions — 更新数据</h3> <ul><li><strong>必填：</strong><code>true</code></li> <li><strong>类型：</strong><code>{[action: string]: (...arg: any[]) =&gt; any;}</code></li> <li>actions的成员必须是函数，如果不设置中间件，那么它返回的任何数据都会作为新的state，并通知使用此模块的react组件更新，这是在natur内部完成的。</li> <li>actions必须遵照immutable规范！</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// actions用来修改state。它返回的数据会作为新的state(这部分由natur内部完成)</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 在组件中你获得的数据为
 * demo: {
 *  state: {
 *    number: 1,
 *  }
 *  actions: {
 *    inc: (number) =&gt; 新的state,
 *    dec: (number) =&gt; 新的state,
 *  }
 * ...
 * }
 */</span>
</code></pre></div><h2 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h2> <h3 id="注入多个模块"><a href="#注入多个模块" class="header-anchor">#</a> 注入多个模块</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 导入你之前创建的inject函数，详情请参考上面的简单例子</span>
<span class="token keyword">import</span> inject <span class="token keyword">from</span> <span class="token string">'your-inject'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'module1'</span><span class="token punctuation">,</span> <span class="token string">'module2'</span><span class="token punctuation">,</span> <span class="token comment">/* ...其他更多的模块名 */</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="同步更新数据"><a href="#同步更新数据" class="header-anchor">#</a> 同步更新数据</h3> <ul><li>这里我们默认使用<a href="#%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%85%8D%E7%BD%AE">官方推荐的中间件配置</a>, 详情请看中间件部分</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里是同步更新state中的name数据</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="异步更新数据"><a href="#异步更新数据" class="header-anchor">#</a> 异步更新数据</h3> <ul><li>这里我们默认使用<a href="#%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%85%8D%E7%BD%AE">官方推荐的中间件配置</a>, 详情请看中间件部分</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里是异步更新state中的name数据</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="异步多批次更新数据"><a href="#异步多批次更新数据" class="header-anchor">#</a> 异步多批次更新数据</h3> <ul><li>这里我们默认使用<a href="#%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%85%8D%E7%BD%AE">官方推荐的中间件配置</a>, 详情请看中间件部分</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;natur/dist/middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  now<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里是异步多批次更新state中的name数据</span>
  <span class="token function-variable function">updateNow</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>setState<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> state<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 每秒更新一次now的值</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>now<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在actions中获取最新的state-maps值"><a href="#在actions中获取最新的state-maps值" class="header-anchor">#</a> 在actions中获取最新的state，maps值</h3> <ul><li>这里我们默认使用<a href="#%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%85%8D%E7%BD%AE">官方推荐的中间件配置</a>, 详情请看中间件部分</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;natur/dist/middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> maps <span class="token operator">=</span> <span class="token punctuation">{</span>
  nameIsTome<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> name <span class="token operator">===</span> <span class="token string">'tom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">updateName</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>getState<span class="token punctuation">,</span> getMaps<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> state<span class="token punctuation">,</span> <span class="token keyword">typeof</span> maps<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取最新的state值</span>
    <span class="token keyword">const</span> currentState <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取最新的maps值</span>
    <span class="token keyword">const</span> currentMaps <span class="token operator">=</span> <span class="token function">getMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  maps<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在actions中调用其他的action"><a href="#在actions中调用其他的action" class="header-anchor">#</a> 在actions中调用其他的action</h3> <ul><li>这里我们默认使用<a href="#%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%85%8D%E7%BD%AE">官方推荐的中间件配置</a>, 详情请看中间件部分</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;natur/dist/middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">loading</span><span class="token operator">:</span> <span class="token punctuation">(</span>loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fetchData</span><span class="token operator">:</span> <span class="token punctuation">(</span>newName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用loading方法</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 你也可以调用其他模块的actions，但不建议广泛使用</span>
    <span class="token comment">// dispatch('otherModule/actions', /* ...arguments */);</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> newName<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="组件只监听部分数据的变更"><a href="#组件只监听部分数据的变更" class="header-anchor">#</a> 组件只监听部分数据的变更</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 导入你之前创建的inject函数，详情请参考上面的简单例子</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'your-inject'</span><span class="token punctuation">;</span>

<span class="token comment">// 这里App组件只会监听app，state中name的变化，其他值的变化不会引起App组件的更新</span>
<span class="token keyword">let</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 也可以使用函数声明 state: [s =&gt; s.name]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 这里App组件只会监听app，maps中deepDep的变化，其他值的变化不会引起App组件的更新</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'deepDep'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// or</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'deepDep'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 这里App组件不论app模块发生什么变化，都不会更新</span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or </span>
injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 


<span class="token comment">// 因为actions在创建后会保持不变，所以你不必监听它的变化</span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>app<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token keyword">typeof</span> injector<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取注入的app模块</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> maps<span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input
      value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token comment">// app中的数据</span>
      onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> actions<span class="token punctuation">.</span><span class="token function">changeName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 复杂的例子</span>
<span class="token keyword">let</span> complexInjector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>xxx<span class="token punctuation">]</span><span class="token punctuation">,</span> maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xxx'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
complexInjector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'other'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'other'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>state<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>xxx<span class="token punctuation">]</span><span class="token punctuation">,</span> maps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xxx'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="懒加载模块配置"><a href="#懒加载模块配置" class="header-anchor">#</a> 懒加载模块配置</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/*
  module1.js
  export {
    state: {
      count: 1,
    }
    actions: {
      inc: state =&gt; ({count: state.count + 1}),
    }
  }
  
*/</span>
<span class="token keyword">const</span> otherLazyModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// module2: () =&gt; import('module2');</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">module1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 懒加载模块</span>

<span class="token comment">// 创建store实例</span>
<span class="token comment">// 第二参数就是懒加载的模块；</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> module1<span class="token punctuation">,</span> <span class="token operator">...</span>otherLazyModules <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 然后用法等同于第二步</span>
</code></pre></div><h3 id="初始化state"><a href="#初始化state" class="header-anchor">#</a> 初始化state</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncChangeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
  createStore第三个参数
  {
    [moduleName: ModuleName]: Require&lt;State&gt;,
  }
*/</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> 
    initStates<span class="token operator">:</span> <span class="token punctuation">{</span>
      app<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'jerry'</span><span class="token punctuation">}</span> <span class="token comment">// 初始化app 模块的state</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><hr> <h3 id="跨模块的交互的复杂业务场景"><a href="#跨模块的交互的复杂业务场景" class="header-anchor">#</a> 跨模块的交互的复杂业务场景</h3> <blockquote><p>在复杂的业务场景下，通常会存在多个模块之间相互监控，调用的场景，所以为了这种场景，可以使用<a href="/zh/natur-service/">natur-service</a>无侵入性的解决方案，可以监听模块的任何变动，以及无侵入性的开发复杂的业务逻辑，同时保留每个模块的简洁和可维护性。</p></blockquote> <h3 id="加载时候的占位组件配置"><a href="#加载时候的占位组件配置" class="header-anchor">#</a> 加载时候的占位组件配置</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createInject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token comment">// 全局配置</span>
<span class="token keyword">const</span> inject <span class="token operator">=</span> <span class="token function">createInject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">storeGetter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">,</span>
  <span class="token function-variable function">loadingComponent</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 局部使用</span>
<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">loading</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在react之外使用natur"><a href="#在react之外使用natur" class="header-anchor">#</a> 在react之外使用natur</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 引入之前创建的store实例</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'my-store-instance'</span><span class="token punctuation">;</span>

<span class="token comment">/*
  获取注册的app模块, 等同于在react组件中获取的app模块
  如果你想要获取懒加载的模块，
  那么你必须确定，这个时候该模块已经加载好了
*/</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  如果你确定，懒加载模块，还没有加载好
  你可以监听懒加载模块，然后获取
*/</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> lazyModule <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
state: {
  name: 'tom'
},
actions: {
  changeName,
  asyncChangeName,
},
maps: {
  splitName: ['t', 'o', 'm'],
  addName: lastName =&gt; state.name + lastName,
}
*/</span>



<span class="token comment">/*
  当你在这里使用action方法更新state时，
  所有注入过app模块的组件都会更新，
  并获取到最新的app模块中的数据，
  建议不要滥用
*/</span>
app<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">changeName</span><span class="token punctuation">(</span><span class="token string">'jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'changeName'</span><span class="token punctuation">,</span> <span class="token string">'jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 
 * type: 模块变动的类型
 * init: 模块初始化事件
 * update: 模块state更新事件
 * remove: 模块移除事件
 * 
 * actionName: 模块更新state时的action名字
 */</span>
<span class="token keyword">type</span> <span class="token class-name">ModuleEvent</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'init'</span> <span class="token operator">|</span> <span class="token string">'update'</span> <span class="token operator">|</span> <span class="token string">'remove'</span><span class="token punctuation">,</span>
	actionName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 监听模块变动</span>
<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>me<span class="token operator">:</span> ModuleEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里可以拿到最新的app数据</span>
  store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 取消监听</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="手动导入模块"><a href="#手动导入模块" class="header-anchor">#</a> 手动导入模块</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// initStore.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token comment">// 在实例化store的时候，没有导入懒加载模块</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">/*...modules*/</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ================================================</span>
<span class="token comment">// lazyloadPage.ts 这是一个懒加载的页面</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'initStore.ts'</span>

<span class="token keyword">const</span> lazyLoadModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">nameSplit</span><span class="token operator">:</span> state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">addName</span><span class="token operator">:</span> state <span class="token operator">=&gt;</span> lastName <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>name <span class="token operator">+</span> lastName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
手动添加模块，在此模块被添加之前，其他地方无法使用此模块
要想其他地方也使用，则必须在store实例化的时候就导入
*/</span>
store<span class="token punctuation">.</span><span class="token function">setModule</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">,</span> lazyLoadModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">lazyLoadView</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 现在你可以获取手动添加的模块了</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> maps<span class="token punctuation">,</span> actions<span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'lazyModuleName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dispatch"><a href="#dispatch" class="header-anchor">#</a> dispatch</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> InjectStoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 存放数据</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// state的映射。比如，我需要知道state中的number是否是偶数</span>
    isEven<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 用来修改state。返回的数据会作为新的state(这部分由natur内部完成)</span>
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建store这一步需要在渲染组件之前完成，因为在组件中，需要用到你创建的store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>actions<span class="token punctuation">,</span> state<span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getModule</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span>

actions<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等于</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'inc'</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="拦截器"><a href="#拦截器" class="header-anchor">#</a> 拦截器</h2> <p><strong>在模块调用action或者store.dispatch时会先经过interceptor，因此拦截器可以应用于，控制action是否执行，以及action的入参控制等场景</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  createStore<span class="token punctuation">,</span>
  Interceptor
  InterceptorActionRecord<span class="token punctuation">,</span>
  InterceptorNext<span class="token punctuation">,</span>
  InterceptorParams<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncChangeName</span><span class="token operator">:</span> newName <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">type</span> <span class="token class-name">InterceptorActionRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  moduleName<span class="token operator">:</span> String<span class="token punctuation">;</span>
  actionName<span class="token operator">:</span> String<span class="token punctuation">;</span>
  actionArgs<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function-variable function">actionFunc</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// 原始的action方法</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">InterceptorNext</span> <span class="token operator">=</span> <span class="token punctuation">(</span>record<span class="token operator">:</span> InterceptorActionRecord<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// InterceptorParams类型于MiddlewareParams类型相同</span>
<span class="token keyword">type</span> <span class="token class-name">InterceptorParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  setState<span class="token operator">:</span> MiddlewareNext<span class="token punctuation">,</span> 
  <span class="token function-variable function">getState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> State<span class="token punctuation">,</span>
  <span class="token function-variable function">getMaps</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> InjectMaps<span class="token punctuation">,</span>
  <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> LogInterceptor<span class="token operator">:</span> Interceptor<span class="token operator">&lt;</span><span class="token keyword">typeof</span> store<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span>interceptorParams<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token punctuation">(</span>next<span class="token operator">:</span> InterceptorNext<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">(</span>record<span class="token operator">:</span> InterceptorActionRecord<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>actionName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> record<span class="token punctuation">.</span>actionArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你应该return, 只有这样你在页面调用action的时候才会有返回值</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    interceptors<span class="token operator">:</span> <span class="token punctuation">[</span>LogInterceptor<span class="token punctuation">,</span> <span class="token comment">/* ...moreInterceptor */</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><h2 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h2> <p><strong>中间件的执行发生在action执行之后，更新state之前。可以接收action的返回值，一般可以应用于action返回值的加工，state更新的控制等行为</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  createStore<span class="token punctuation">,</span>
  MiddleWare<span class="token punctuation">,</span>
  MiddlewareNext<span class="token punctuation">,</span>
  MiddlewareActionRecord
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">changeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncChangeName</span><span class="token operator">:</span> <span class="token parameter">newName</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> newName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">MiddlewareActionRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  moduleName<span class="token operator">:</span> String<span class="token punctuation">,</span>
  actionName<span class="token operator">:</span> String<span class="token punctuation">,</span>
  state<span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">MiddlewareNext</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">record<span class="token operator">:</span> MiddlewareActionRecord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">middlewareParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  setState<span class="token operator">:</span> MiddlewareNext<span class="token punctuation">,</span> 
  <span class="token function-variable function">getState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> State<span class="token punctuation">,</span>
  <span class="token function-variable function">getMaps</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> InjectMaps<span class="token punctuation">,</span>
  <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ReturnType<span class="token operator">&lt;</span>Action<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> LogMiddleware<span class="token operator">:</span> MiddleWare<span class="token operator">&lt;</span><span class="token keyword">typeof</span> store<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">middlewareParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token punctuation">(</span><span class="token parameter">next<span class="token operator">:</span> MiddlewareNext</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">(</span><span class="token parameter">record<span class="token operator">:</span> MiddlewareActionRecord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>actionName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> record<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你应该return, 只有这样你在页面调用action的时候才会有返回值</span>
      <span class="token comment">// return middlewareParams.setState(record); // 你应该return，只有这样你在页面调用action的时候才会有返回值</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    middlewares<span class="token operator">:</span> <span class="token punctuation">[</span>LogMiddleware<span class="token punctuation">,</span> <span class="token comment">/* ...moreMiddleware */</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><h3 id="内置中间件说明"><a href="#内置中间件说明" class="header-anchor">#</a> 内置中间件说明</h3> <h4 id="thunkmiddleware-thunk中间件可以使得action可以返回函数-拥有了获取最新的state-maps-以及setstate-dispatch等增强功能"><a href="#thunkmiddleware-thunk中间件可以使得action可以返回函数-拥有了获取最新的state-maps-以及setstate-dispatch等增强功能" class="header-anchor">#</a> thunkMiddleware: thunk中间件可以使得action可以返回函数，拥有了获取最新的state，maps，以及setState，dispatch等增强功能</h4> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> thunkMiddleware<span class="token punctuation">,</span> ThunkParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur/dist/middlewares'</span>

<span class="token keyword">const</span> <span class="token function-variable function">actionExample</span> <span class="token operator">=</span> <span class="token punctuation">(</span>myParams<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  getState<span class="token punctuation">,</span>
  setState<span class="token punctuation">,</span>
  getMaps<span class="token punctuation">,</span>
  dispatch
<span class="token punctuation">}</span><span class="token operator">:</span> ThunkParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> stateOfThisModule<span class="token punctuation">,</span> <span class="token keyword">typeof</span> mapsOfThisModule<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentState <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最新的state</span>
  <span class="token keyword">const</span> currentMaps <span class="token operator">=</span> <span class="token function">getMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最新的maps</span>
  <span class="token comment">// dispatch('otherActionNameOfThisModule', ...params)</span>
  <span class="token comment">// dispatch('otherModuleName/otherActionNameOfOtherModule', ...params);</span>
  <span class="token function">setState</span><span class="token punctuation">(</span>currentState<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新state</span>
  <span class="token keyword">return</span> currentState<span class="token punctuation">;</span> <span class="token comment">// 更新state</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="promisemiddleware-action支持异步操作"><a href="#promisemiddleware-action支持异步操作" class="header-anchor">#</a> promiseMiddleware: action支持异步操作</h4> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// promiseMiddleware</span>
<span class="token keyword">const</span> <span class="token function-variable function">action1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">action2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">2333</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="fillobjectrestdatamiddleware-state增量更新-覆盖更新-state是对象时才有效"><a href="#fillobjectrestdatamiddleware-state增量更新-覆盖更新-state是对象时才有效" class="header-anchor">#</a> fillObjectRestDataMiddleware: state增量更新/覆盖更新，state是对象时才有效</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 调用此action，最后的state是{a: 11, b:2}此中间件要求
 * state和action返回的数据必须都是普通对象
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="shallowequalmiddleware-浅层比较优化中间件-仅限于普通对象的state"><a href="#shallowequalmiddleware-浅层比较优化中间件-仅限于普通对象的state" class="header-anchor">#</a> shallowEqualMiddleware：浅层比较优化中间件，仅限于普通对象的state</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 与旧的state相同，不做更新视图</span>
</code></pre></div><h4 id="filterundefinedmiddleware-过滤返回undefined的action操作"><a href="#filterundefinedmiddleware-过滤返回undefined的action操作" class="header-anchor">#</a> filterUndefinedMiddleware: 过滤返回undefined的action操作</h4> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// 这种action的返回不会作为新的state</span>
</code></pre></div><h4 id="devtool-开发调试工具"><a href="#devtool-开发调试工具" class="header-anchor">#</a> devtool：开发调试工具</h4> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// redux.devtool.middleware.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> Object <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> actions<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span>Object <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>state<span class="token punctuation">,</span>
  <span class="token operator">...</span>actions<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> createMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>Middleware <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> devMiddleware <span class="token operator">=</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> devMiddleware<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>getState<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> next <span class="token operator">=&gt;</span> record <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>actionName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        state<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token punctuation">[</span>record<span class="token punctuation">.</span>moduleName<span class="token punctuation">]</span><span class="token operator">:</span> record<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> next <span class="token operator">=&gt;</span> record <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="推荐的中间件配置"><a href="#推荐的中间件配置" class="header-anchor">#</a> 推荐的中间件配置</h3> <p><strong>注意：中间件配置的先后顺序很重要</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  thunkMiddleware<span class="token punctuation">,</span>
  promiseMiddleware<span class="token punctuation">,</span> 
  fillObjectRestDataMiddleware<span class="token punctuation">,</span>
  shallowEqualMiddleware<span class="token punctuation">,</span> 
  filterUndefinedMiddleware<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur/dist/middlewares'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> devTool <span class="token keyword">from</span> <span class="token string">'redux.devtool.middleware'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  modules<span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    middlewares<span class="token operator">:</span> <span class="token punctuation">[</span>
      thunkMiddleware<span class="token punctuation">,</span> <span class="token comment">// action支持返回函数，并获取最新数据</span>
      promiseMiddleware<span class="token punctuation">,</span> <span class="token comment">// action支持异步操作</span>
      fillObjectRestDataMiddleware<span class="token punctuation">,</span> <span class="token comment">// 增量更新/覆盖更新</span>
      shallowEqualMiddleware<span class="token punctuation">,</span> <span class="token comment">// 新旧state浅层对比优化</span>
      filterUndefinedMiddleware<span class="token punctuation">,</span> <span class="token comment">// 过滤无返回值的action</span>
      devTool<span class="token punctuation">,</span> <span class="token comment">// 开发工具</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="typescript支持"><a href="#typescript支持" class="header-anchor">#</a> typescript支持</h2> <h3 id="基础用法"><a href="#基础用法" class="header-anchor">#</a> 基础用法</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token comment">// 导入你之前创建的inject函数，详情请参考上面的简单例子</span>
<span class="token keyword">import</span> inject <span class="token keyword">from</span> <span class="token string">'your-inject'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ModuleType<span class="token punctuation">,</span> Store<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 存放数据</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  maps<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// state的映射。比如，我需要知道state中的number是否是偶数</span>
    isEven<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 用来修改state。返回的数据会作为新的state(这部分由natur内部完成)</span>
    <span class="token function-variable function">inc</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">// 生成count模块在组件中获得的类型</span>
<span class="token keyword">type</span> <span class="token class-name">InjectCountType</span> <span class="token operator">=</span> ModuleType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> count<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">otherProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  className<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  style<span class="token operator">:</span> Object<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span><span class="token keyword">typeof</span> injector<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">&amp;</span> otherProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>state<span class="token punctuation">,</span> actions<span class="token punctuation">,</span> maps<span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> actions<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> actions<span class="token punctuation">.</span><span class="token function">dec</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> IApp <span class="token operator">=</span> <span class="token function">injector</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>IApp className<span class="token operator">=</span><span class="token string">'1'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  app<span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="重新定义store类型"><a href="#重新定义store类型" class="header-anchor">#</a> 重新定义store类型</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Store<span class="token punctuation">,</span> createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'natur'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">lazyModule1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allSyncModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">,</span>
  <span class="token comment">/* and others */</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> allAsyncModules <span class="token operator">=</span> <span class="token punctuation">{</span>
  lazyModule1<span class="token punctuation">,</span>
  <span class="token comment">/* and others */</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>allSyncModules<span class="token punctuation">,</span> allAsyncModules<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">StoreInsType</span> <span class="token operator">=</span> Store<span class="token operator">&lt;</span><span class="token keyword">typeof</span> allSyncModules<span class="token punctuation">,</span> <span class="token keyword">typeof</span> allAsyncModules<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// StoreInsType的类型就是store的类型，你可以扩展你的类型</span>
</code></pre></div><h2 id="为什么选择natur"><a href="#为什么选择natur" class="header-anchor">#</a> 为什么选择NATUR</h2> <h3 id="系统设计理念"><a href="#系统设计理念" class="header-anchor">#</a> 系统设计理念</h3> <ol><li><code>natur</code>的初衷是简单自然的掌管项目中所有的业务逻辑，在这方面是不同于<a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer">redux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或者<a href="https://mobx.js.org/README.html" target="_blank" rel="noopener noreferrer">mobx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这样的状态管理库。<code>natur</code>可以轻松的让项目中所有的业务与<code>UI</code>层松耦合，这可以让<code>UI</code>保持足够的简单和纯粹，对于项目的维护性有着很大的好处。</li> <li>在<code>natur</code>中包含两个部分，一个是模块，一个是模块间的通讯以及调用，这里推荐使用的是<a href="/zh/natur-service">natur-service</a>方案</li> <li>模块的<code>state</code>包含了业务数据的存储。<code>maps</code>包含了<code>state</code>衍生数据的逻辑，以及缓存的设计保证性能，值得一提的是，<code>maps</code>使用了手动声明依赖的方式，这也与是<code>react</code>一贯的设计风格相符合。<code>action</code>包含了<code>state</code>数据更新，以及其他业务逻辑（比如一个没有返回值的API的调用），<code>natur</code>推荐<code>action</code>设计的职责明确，一个<code>action</code>只做一件事原则。如果能让每个<code>action</code>的执行有对应<code>state</code>变化，那么这能够让整个项目具有可观测和追踪性，并且可以更好的为模块间的通讯服务(可观测和追踪性可以通过<a href="#%E6%8B%A6%E6%88%AA%E5%99%A8">拦截器</a>和<a href="#%E4%B8%AD%E9%97%B4%E4%BB%B6">中间件</a>来实现)。</li> <li>在模块通讯这里，<a href="/zh/natur-service">natur-service</a>推荐使用一个类管理一个业务模块或者一个业务流程而非一个<code>natur</code>模块对应一个<a href="/zh/natur-service">natur-service</a>类。模块通讯的设计规范方面，则是建议在自己的<code>service</code>中<code>watch</code>别的模块，而非在别的<code>service</code>中<code>dispatch</code>自己模块中的<code>action</code>，这样也能保证开发人员与业务模块的职责明确。<code>service</code>类的设计应尽量保证简单，只包含<code>natur</code>模块的<code>watch</code>以及<code>dispatch</code>等逻辑。更加丰富的逻辑建议维护在<code>natur</code>的模块中，以保证模块的功能完善。</li> <li>在<code>natur</code>模块的设计方面，则是推荐用户细分模块，明确模块的边界，以及粒度，以保证模块的可维护性。确保一个<code>natur</code>模块中只处理自己的业务，而不需要关心其他模块，与别的模块没有耦合。</li> <li>因为<code>natur</code>模块的创建和使用方式足够的简单，所以使得开发在设计方面能够尽可能简单自然的写出符合<code>natur</code>设计理念的项目，当然最主要的还是开发人员需要明白<code>natur</code>的设计理念并遵循它。</li></ol> <h3 id="与redux对比"><a href="#与redux对比" class="header-anchor">#</a> 与redux对比</h3> <ol><li>首先<a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer">redux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是全局状态管理器，这与<code>natur</code>的项目业务逻辑管理的设计目标是不同的。</li> <li>其次<a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer">redux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的使用成本比较高，<code>natur</code>使用则是非常的简单</li> <li>性能方面，在<code>natur</code>中存在缓存、<a href="#%E6%87%92%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE">模块懒加载</a>，以及<a href="#%E7%BB%84%E4%BB%B6%E5%8F%AA%E7%9B%91%E5%90%AC%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%98%E6%9B%B4">部分监听功能</a>的支持，你不需要额外的库来保证你的项目性能。</li></ol> <h3 id="与mobx的对比"><a href="#与mobx的对比" class="header-anchor">#</a> 与mobx的对比</h3> <ol><li>兼容性方面，因为<a href="https://mobx.js.org/README.html" target="_blank" rel="noopener noreferrer">mobx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>使用了<code>proxy</code>或者<code>defineProperty</code>等<code>API</code>所以兼容性要稍微差点</li> <li>在模块通讯方面，mobx的设计无法完美结耦，这个是一个遗憾</li> <li>性能方面，<code>mobx</code>的缓存性能优化依赖<code>immutable</code>所以在使用友好性方面较于<code>natur</code>更好, 但是<code>natur</code>也有着<a href="#%E6%87%92%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE">模块懒加载</a>这样的功能优于<code>mobx</code></li></ol> <h2 id="使用注意事项"><a href="#使用注意事项" class="header-anchor">#</a> 使用注意事项</h2> <ul><li><p>由于低版本不支持react.forwardRef方法，所以不能直接使用ref获取包裹的组件实例，需要使用forwardedRef属性获取（用法同ref）</p></li> <li><p>在TypeScript中的提示可能不那么友好，比如</p></li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code>@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 此使用方法会报错，提示App组件中无forwardedRef属性声明</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token attr-name">forwardedRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">// 以下使用方式则不会报错</span>
<span class="token keyword">class</span> <span class="token class-name">_App</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_App<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 正确</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token attr-name">forwardedRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li><strong>在actions中修改state，需要遵循immutable规范</strong></li></ul> <h2 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h2> <ul><li><a href="/zh/natur-service">natur-service: natur上层调度库</a></li> <li><a href="/zh/natur-persist">natur-persist: localStorage数据持久化插件</a></li> <li><a href="/zh/natur-persist-async">natur-persist-async: 异步数据持久化插件</a></li> <li><a href="/zh/natur-immer">natur-immer: immer插件</a></li> <li><a href="/zh/umi-natur">umi-natur: natur的umi插件</a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2022/4/26 13:20:13</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.01c74c59.js" defer></script><script src="/assets/js/2.e4845fa5.js" defer></script><script src="/assets/js/7.8bff41c0.js" defer></script>
  </body>
</html>
